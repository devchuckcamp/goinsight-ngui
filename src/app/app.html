<ti-app-layout>
  <ti-question-form (submitQuestion)="onAskQuestion($event)"></ti-question-form>

  @if (state.loading()) {
    <div class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Analyzing your feedback data...</p>
    </div>
  }

  @if (state.error(); as error) {
    <div class="error-banner">
      {{ error.message }}
    </div>
  }

  @if (state.lastResponse(); as response) {
    <ti-insight-summary [summary]="response.summary"></ti-insight-summary>

    @if (response.data_preview.length > 0) {
      <ti-data-preview-table [data]="response.data_preview"></ti-data-preview-table>
    }

    @if (response.recommendations.length > 0) {
      <ti-recommendations-list [recommendations]="response.recommendations"></ti-recommendations-list>
    }

    @if (response.actions.length > 0) {
      <ti-actions-accordion [actions]="response.actions"></ti-actions-accordion>
    }
  }

  @if (!state.hasResponse() && !state.loading() && !state.error()) {
    <div class="empty-state">
      <div class="empty-state__icon">&#128161;</div>
      <div class="empty-state__title">Ready to analyze your feedback data</div>
      <div class="empty-state__subtitle">Enter a natural language question above to get started</div>
    </div>
  }
</ti-app-layout>
